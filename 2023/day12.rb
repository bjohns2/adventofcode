test_input = "???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1"

my_input = "?.?????#???#? 1,1,2,2
????.#????#?????#??# 1,2,1,1,7
???#?.???????.? 3,1,1,1,1
????#.??.? 1,1,1
.?#??????.? 3,1,1
#????#???????? 1,9
?.?##????????#?. 6,2
#..??#?#?#????? 1,3,5,2
?????????#????????. 3,1,4,1,2,1
????#.???????????? 1,1,1,2,8
?#..#????.?#?##????? 1,1,1,5,1,1
????##.#???? 1,4,1,1
??#...?#?#? 1,4
?.#.????#??????#??? 1,1,4,1,3,1
??.?#?.???#?????#?? 3,10
????????#????? 1,3,2,1
???.?????##??.?? 1,7
????????#.?????#?? 8,2,2
???????.????.#?# 3,1,1,3,3
????????????..? 1,6
.#??#?.??????# 1,3,3,1
?..#.???.? 1,2,1
??????#??. 1,1,4
.??#??##?????????.?# 1,8,2,1
???#?#?.????????.??# 6,1,3,2,1,1
??###????????#??.#? 9,5,1
?#?##???.#.?#???? 1,5,1,4
?.??.??#?????? 1,1,6,2
????.????? 1,4
??????????#.??? 1,4,1,2,1
?#??????#.????# 1,1,2,3,1
?.??..??#.? 2,2
???.?????.?? 2,1,1,1
?#.?#??.????.????? 1,3,1,1,3
???#??#?.#?????#.? 7,4,2,1
??#??#??.#?#??#???? 1,1,1,4,1,1
??.#?.?#..??.#?#?#. 1,2,1,1,5
????????#?#?.????? 2,8,1
?????..?#?#?.. 3,5
?????????#?#?#????? 1,9,1,1
??????##?#?.???????# 2,6,1,1,1
??????..????????# 3,1,3,2
#?..?#?????#???. 1,1,6,1
??.??.????. 1,2
?..????????? 1,1,3
???#?#??.??? 1,1,1,1
????#??##.???? 1,6,1,2
.????.?#????. 3,2,1
?#?.???.?.. 2,1,1
????##.?.???#?#? 1,4,1,6
.#?#.??####??????? 3,9
?.?#?????.??##..# 2,3,3,1
..#???#?#?#??. 2,8
#.??????????.?## 1,1,1,1,3
.?????.???#?##?# 3,7
?##.??.#????#??#? 2,1,3,2,1
.???##?????. 1,2,2
#.?###????#?...# 1,9,1
???##.??#?#?#. 1,3,5
.????##??????.. 4,3
?.??.??#??????? 1,2,3,2
#####???.. 5,1
?####???.????? 4,1,1
????????#?. 2,2
???.??????.????? 1,3,1,4
.?????????#????.#?? 12,1,1
?#..?#????#???.???# 2,8,1,2
???#???#??#??????..# 12,1
?#..?#??##?#??.?. 2,6,1,1,1
.????##???? 2,5
?????#????? 1,2,1
?#??#????#?#???#? 11,3
?????.?.##??? 1,2
###???..?#?#???##?? 3,1,9
#.??#..?##?? 1,1,4
.##??????.#??##?#? 3,1,7
???#????..? 1,2,1
#???#?.?#.? 1,2,2
?#.??#????? 2,4,2
???#??#?????#???? 4,8,2
??????????.# 4,1
#?????????#?##?. 1,2,1,1,5
???.???.?.?.. 2,1,1,1
.?#????????? 1,2,1
..?.??.?#?? 1,1,2
??#?#?????.??. 9,1
????#?..???#????. 1,1,8
??..#.??#?#???.?#??# 1,1,7,1,1
?#??#????.??? 2,5,1
#?..???##???.??? 2,1,5,2
.??#??#?#.?.????##. 7,5
?????.##??#? 4,3,1
.#??##??#?????..??.? 1,10,2
???###??#?. 1,3,2
??#?????## 1,5
??#???????.??? 1,1,2,1
.???#?.??.???. 3,2
#?#??#..?#?????#?? 3,1,2,1,1,1
.???????#??#?? 1,5,1
?.??#.???#????? 1,1,1,2,1
?#?????#?.?????#?? 4,1,7
.?#.???#??##? 1,2,3
?##?..????.?#?????? 3,2,1,6,1
#.?.??###??.#???.?? 1,1,4,1,1,1
??????.??.??? 2,1,1,1
?#??.????#.? 2,3
.??.#?.????#?##??## 2,2,5,6
##????.??#?? 2,1,1,1
??#?#???#?? 4,4
?????.????????#? 1,3,2,1,1
.??..#????#???.??? 1,9
???.?#?.????. 1,3,1,1
.???????#?.???# 4,2,2,1
.##?#????..??#??#?. 2,5,1,1,1
??????#?#???..????? 10,1,4
.?#?..??.??.???#?? 3,1,2,6
#.??#?#??????#?. 1,5,1,1
??###????????????? 4,2,1
.?.???.#??.#???.?# 1,1,2,1,1,2
.???.??#??????.? 2,1,4,1
?.???##??# 1,6
?.#?#??.?#?#??.#?.?# 1,2,4,1,2
?..#??#???? 1,2,2
?#?###?#?.????# 2,3,1,5
.?????.???#??### 1,1,1,1,7
????#?????#?? 1,5,1,1
?????????? 2,2,2
??##??????????#???? 4,3,5
##????##???.. 5,4
.???#??#???. 1,5
??##.?.?#? 4,1
.???#?#??.???#? 4,3,4
?##?##??????..??? 11,2
?.???.###???#?.? 1,1,7
.???????????#?? 1,1,5
???#.?.???? 1,1
??.??#?????.. 1,8
.??.????????.? 1,1
??#????#.# 2,1,1
.????.?##????.? 1,1,4,1,1
.?.????????? 1,3,1,2
???.#??..#???. 1,3,3
#???#?.??. 1,3,1
???.?#???.????? 1,4,1,1
?.????#?#?.??? 1,8,1
#?.?#???.#..???? 2,2,1,1,1
?.??#?????.???.. 1,1
.??#?.#???????..? 1,2,1,6,1
?##.#?.?#?##???##?. 2,1,10
.##????.#?.??#.##?? 6,2,3,2,1
???????#??? 4,3,1
????.??.?? 4,1
.?#??????#???#? 1,1,3,4
#??.?..##??????# 3,1,2,3,1
?#?#??.???? 2,1,3
?#?#????..##???? 4,2
?#????.??##?#?.??#. 2,1,5,1,1
??#???????????.? 9,1
?.??##?????.?. 4,3,1
?????#???##? 6,2
????#??.??.?#??.#? 1,1,2,1,3,1
.?.??.?????????? 1,1,2,2,1
?.?.?????#? 1,2,1
.???.?##??#???????. 1,12
.#????????.#??.???? 1,6,1,1,1
???##??.???#????? 7,6,1
.#????#???????.. 2,9
.?##???#?.???#?#. 7,1,3
.#???????? 2,2
##.#.?#?#??????# 2,1,6,3
?#???????? 1,2,1
?????????#??# 2,7
.???.#...??#.??#?? 1,1,1,3,1,3
??#?#?#.?#.??.? 6,1,1
????.???#?.#?? 1,1,2,2
?????.??..#??# 3,2,4
#?.????##???##?????. 2,7,2,4
?#.#?#???##?.????? 1,1,7,2,1
.#?##.???? 4,1
#?????#???# 7,1
??###????.??? 5,1,1
??#????#??????.?? 8,2
#?##??#?#??##.?. 1,7,2,1
????????.?? 7,1
??###???##????.???? 12,2,1
??????###??#??? 7,3
#.#?##?..???#.# 1,1,2,4,1
?.??#?#?##??????.? 1,10,2,1
?#??????.???#?? 4,1,6
??.?#??#??#?????. 1,8,1
???.?#?#??????##. 2,4,3
????????.#????? 1,2,1,2,1
#???.??#???? 1,1,1,2
#..??????#??? 1,1,8
#?.#?..###? 1,2,3
??????...?#?? 2,2
?#????#????? 1,1,5
#?.?##?????? 2,3,3
????.??#??? 1,1,4
.??#??..??????#.. 4,3
???..??..#?.?? 3,2,1,1
#.#??#???#? 1,1,6
.??????#.????#.?.?# 1,4,1,1,1,2
???##.???##????? 3,7
#.??????????#???? 1,1,10
????????##??###??? 1,4,8,1
#???????.??###?? 1,2,4
.?#??????.?.??? 3,1,2
??..#.#????#?#?.? 2,1,2,4
?#?#?#???.?#???#??#. 6,2,2,2,1
??#???.?##.??#?? 2,2,2
????.?#??.. 2,3
????.?##???.? 2,4
..?#?#???????? 2,9
?#???.####?###? 2,9
???##?????##???.??? 4,1,6,1,1
?#.?????.???? 2,2,1,1
.??.???????#?#?#?.?? 1,2,8,1
?#???...?????????? 4,3,2
??...#??????.? 1,1,5,1
?.#???##???????? 1,1,6,1,1
????????.#????? 6,1,1
?###???.##??? 5,2,1
???#.#?#???#???? 4,3,1,1,1
?.?????##??? 1,3,3,1
?#??##.??#.?? 5,2,1
?????.?????????#..? 4,5,1
??????##???# 4,3,2
?####??#?#.?#?##??? 7,1,2,3,1
#?????.#?????#. 3,1,1,1,1
#????#??.#???# 8,2,1
??.#?.?????? 2,1,6
??#???.?#?###?#?#??. 5,9
?.#?????#??#?????#?? 14,2
?####??.?..? 5,1
..?.?#?##?????##???? 12,1
?#???????#?#?? 4,8
??#??.?#??#?? 4,3,1,1
???..??.??##? 2,1,2
??#.?##??###.# 2,8,1
#???????#?. 1,1,2
.????????#.? 1,4,2,1
??#?##???.???#.???? 1,1,5,1,1,2
.?#????#????? 4,1,1
?#??###?.???.? 2,3,3
..???.?##?# 2,4
..???#????#. 3,2
.???.?##??? 3,2
.?#????.?? 1,1,1
??##???#??# 8,1
????##??#??#????.?? 13,1,1
??.??###????#?#?? 1,4,6
??..????.?. 1,2
???#?.#????? 1,1,1,1
?#????#???#..#.#?? 3,4,1,1,3
#?#??#?????. 1,1,7
#????##??#?#??.???? 13,2
??.??#?#?#?.#?#??? 1,1,1,4,4
#.?..????? 1,1,1
???##???.#???. 6,1,2,1
#?.#?.??##?? 1,1,1,4
?.???.????#??#??#? 1,1,1,1,2,4
#?#?#?????...#?#??## 6,3,3,2
#?#??????#???#.? 1,2,1,1,2
?#?.?#?#????.#. 2,6,1
????????#?###???? 1,1,8
#??#????##? 1,2,3
???#??.???#?? 2,1,1,1
#??#?.?#??#?..?#???? 4,6,4
.????..??? 1,1,1
??#???#????#? 7,2
#.??.???????#??##??? 1,1,15
.?#...?###????? 2,8
???.?#?.???? 1,3,1
???.??.??.?. 2,1,1
##?#??#??#?#?.?#? 7,4,2
???????????.?#?# 10,4
#????????#? 1,2,1
#?.?#??????? 1,9
..???#??##??.#?#??#? 1,1,3,1,6
??.??????? 1,6
.?.??.?????##?#?? 2,9
?.????????? 1,4
#.#??????#??#??? 1,8,4
???##????????.??# 8,1,1
???#??????? 2,2
???.????..? 1,2
??#???.??#?????# 2,1,9
?..?#????.#????? 3,1
?.#..?##.???? 1,3,1
????#??????#??#.??## 14,4
??#?#.??????????..? 1,1,1,1,8,1
??.??..?..?#?? 1,1,4
??##????.?#? 8,1
???##????? 4,1
?.?????.#?????.???? 4,1,2,2
#.???#??##??#?# 1,8,3
???.?.#??????????? 1,1,4,5
?.???..??.??.? 2,1,2
???#???#???????? 7,1
?.???#?.?##??????#. 1,2,7,1
?#?.????.#.??? 2,3,1,2
???.???#?.#???# 2,1,1,1,1
.??#???..?.? 1,2,1,1
.????##???##???? 1,2,5,1
.?#.?.?#?. 1,3
?##???.?#???. 4,2
..#??.???.??????# 1,1,3,2
??.???#??????#? 2,4,1,1,2
???????#????#??.??#? 10,3,2
?.?#???????????#??? 2,1,7
??????#??##??###??? 15,1
..#?##??????? 4,3
#???#?.?#?#? 1,4,3
.???????#? 4,2
??.#?##?.?##?????#?? 1,5,8,1
#.??..???????##??? 1,1,9
???????#?. 6,1
?#?#????#.#.?? 3,3,1
??????????.?.?. 1,1
??.#?#?##? 1,7
?.#??#??????????# 1,4,1,5
??.??.??????. 1,1,4
?#??#????#????..?.#. 1,8,1,1
?#.????????..?????? 1,4,5
??#??????? 1,4
?..??#????###? 1,2,6
##?#??..??????#. 5,1,1
????.??.?#??? 2,5
.???????.#.?????? 1,4,1,6
??????##??#.?#? 8,1,1
?????.#?#?#? 5,1,1,1
##??#.?.???#?# 2,2,1,5
##.???.#???..????# 2,1,1,2,1,1
?#???#..??.???. 2,3,2,2
?#??????#? 1,1,2
???????.?? 1,1,1
???##??##???.??##? 5,4,5
??????.??##? 3,4
#?????#?#???#? 3,1,3,2
#?#???#??.????? 3,2,2,1
?.?##??.?????#.?. 4,4
?????.??#?.??# 3,3,2
???#?#????????#?##? 3,4,1,6
??#??#..??. 4,1
#???????###?.?#? 2,1,7,1
#???#?##???. 1,1,5,1
.??#?##????.? 6,1,1
???#?????#??#?#???? 7,7,2
#.??.?#?#.?#..?#? 1,4,2,2
.?#?##?????.? 4,1,1
??..?#?..? 1,3
???.?????#?? 1,5
?????..#??#?## 2,1,7
??.?.?#?#? 1,5
??.#.?#?.??# 1,1,3
.??.?#??#???? 1,1,3,1
?#???###???? 3,7
.?#??.?..??###? 1,1,4
?##??????# 3,1,2
???.??##???? 2,2,1
.??#??#??##?#?? 2,8
????#??#???#?? 6,1
#????????#?#?.? 7,4,1
.##?????.??#???????? 3,2,1,6
?#?#?.????????? 5,1,2,1
????#??.?# 2,2
?.???###????#?????? 12,1
????#????????###?#? 1,1,1,1,7
??.?#??.#?? 1,3,3
????#?????????? 3,5,1,1
?????????.??.???#?? 7,1,1,1,2
.????###?#????? 1,1,3,1,1
????????.?????#?# 1,1,4
??.??.?.?? 2,1,1
.??????#??????? 2,9
#.???##?#????.??.?? 1,5,3,1,1
?????.??###.??#???? 1,1,4,1,1,1
??#?.?#??? 1,2,1
???#???#???.?????? 1,1,1,1,1,6
???##????.?#??????? 1,6,6,1
???#???##???.?????? 4,4,1,2,2
?????????.??? 1,1,2,1
????.#??.# 3,1,1
?.???.?.????.?..?#?? 1,1,3
??.#???###?##???..? 2,1,8,1,1
?????.??????? 1,7
????.????????.? 2,1,1,3,1
#?#.?..#?#??###??? 3,1,1,1,4,1
.?#????##?#???..???. 10,1,2
.??#.????.??????# 2,2,5,1
??#.???????#?????? 1,10
????#?#.???#??##?. 5,6
??#???????## 1,2,2
.?.?.?.??? 1,1,1
.????????.?.#?? 6,2
.???????#?.?.? 6,1
?.?#??#?.??#.# 5,1,1,1
??????????????.?.? 1,4,2,1,1
..??#???.???#???#? 2,6
????#??##??.#??#? 1,1,4,2,1
.?#???#?.?? 1,1,2
?????.??.#.???? 5,1,1,1
.#?.???#????#??#??#? 2,5,1,1,6
?????.?##??.? 1,1,4,1
.#????????????#??? 7,4
???..##?#?? 1,4,1
.?.??#??.#???? 1,2,3,1
???#?????##??#.. 5,1,4,1
.?##?.??.? 4,1
#..?.?#??# 1,3,1
#????#?.#.???.?# 1,3,1,1,1
#???#?.????#???#??? 2,1,2,9
???.??.#??? 2,1,4
#???#?#.??????? 1,1,3,3
??#?#??.??#??.# 4,3,1
..???##?.?#.? 6,1
.#???##????. 6,1
#..??.??????#????? 1,1,1,4,1,1
.????.?.#?.?#? 1,1,2
?#.?#???????#????? 1,14
#???#.?..?.???.? 5,1,1
#???????###. 2,6
?#??#?????#?.#?#?? 8,1,1,1,1
?????..?.?#???#?## 3,1,8
..???????. 3,2
.?#?????.??????#??.? 1,2,1,3,3
???#.????#? 2,3
#.#??.?.?##?#????? 1,1,1,7,1
????#???#??????#.. 5,8
?#???#??#???###?. 3,6,3
????#?.?????? 4,5
#??.?????##??#??#?? 1,1,1,1,9
?#?????#???.? 3,4
..???.??###?? 1,3
??.??.#?#?? 1,3
#??????????#..? 1,1,3,4,1
?????#???##?? 1,1,2,4
?.????????????#?###? 2,5,6
?#?.##???.?? 2,4
???????.#?? 1,1,2
???#????.#.??..?? 1,5,1,1,1
??.??.?.???#? 2,1,3
???????.?.#???#????? 3,1,1,2,4,1
.##?????.?? 5,1
??????????? 2,4
?????#????????? 1,1,6,2
???????#???.???. 5,1,2,1,1
??##??????.? 2,1,1
?#??#?##?#?#??#???. 2,8,1,1
??##????????.???.. 5,3,3
???????#???#???.?# 1,1,5,1,1,2
.???..???#?#?### 1,1,1,7
????#?.?.?#? 4,1,1
????#?#??#?#??????? 1,12,2
??????.???? 1,1,2
...???..#? 3,1
?####???.? 4,1,1
?.?#??###????.?? 3,3,1
????#????#.???.## 2,6,1,1,2
?.???.???#??..??? 1,2,6,1
?#??#???.????? 8,1
?#.#????.#????????#? 1,1,3,7,1
???#????#???#?#??? 10,1,1
????.?#?#?#?? 2,7
.???.#???##??????.? 2,8
.?#...#???? 2,1,1
?#??#??.??##?????# 2,1,1,3,1,2
????###???#??? 6,2
?????????????.##??. 3,4,2
???.??#??#?.#.???# 1,1,1,1,1,4
?????##??.?. 2,4,1,1
??.???????????# 2,3,2
?.???????#??#?????. 1,3,10
??????????##?#???. 1,1,9,1
?#?#..????##?#?# 2,1,9
???##?#???.??????? 7,1,3,2
???????#.?? 3,1
??#?#.???????? 5,1,1
??#?.???####??#?.? 1,1,1,6,1,1
.??#???.#? 5,2
?????#??..#?##???? 4,8
.??????##?#?###?# 4,11
??..#.?#???.#?#? 1,1,1,1,4
.??##?????.??.?????. 9,4
?.?#????#???#..?. 1,1,6
?#?#?#??????#? 1,4,2,2
?#...#.??#.??? 1,1,2,2
??????.?#?.?##???? 1,2,3,3,1
?#?#?..#?# 4,1,1
?..#.#??#??###?# 1,1,2,6,1
##??#.????????????. 5,2,3,1,1
??????????? 2,1,1
#.??????#??? 1,7,1
#..??.???.??. 1,2,2,1
??#?????#????????? 5,1,5,1,1
.??#??.??. 3,1
???..?..?##?#??. 1,4
?????#?#?#? 6,2
???#???.??????. 6,2
?.????#?##?#?#?????? 1,1,8,1,1,1
???#.???##?#??#. 4,7
???..?##??#? 3,5
???..#?#??.???. 3,5
?????.??#??????####? 1,1,7,5
.??##????????##? 1,3,7
?#?????#?.???#.?? 9,1,2,1
??.##??#???????? 1,2,2,1,2
.?#??###.??#.? 6,1,1
???.?#??#.???#####? 2,1,2,7
?#???????#.?? 1,1,2,1
..????##?.??.??# 3,1
.?..????????#??????? 1,13,1
#???.???#?.??# 4,5,2
.?#.?#????? 1,1,2
??.???#?#?? 1,2,1
???.?????#?#?# 1,1,9
?????.??????#?#? 4,4
????#?.???#????#? 1,2,1,7
?????????????.??? 4,1,2,1
.?#???.??# 5,1
#?????????. 2,1,1
????#?.?.???#????? 5,1,2,1,1,1
##????.??.?? 3,1,1,1
.##?#??##..??#?#?#?. 8,7
?????.#??.???.?#???. 5,1,1,1,2,1
..##??..?? 2,1
.?#????#?#????? 2,1,9
.##???????? 3,3,1
#??.?#???#??#?? 3,1,5
##?##????????#?????? 8,1,1,1,1,1
??#?..???# 2,3
???#????..? 1,5
##?#??.#????? 6,3,1
???#?#?#??#?#??. 2,1,1,1,5
??#?#??#????#????#? 5,2,8
..??#?#??.??? 6,1
??????#????? 6,1,1
????????#????#?#.? 3,2,2,1
?.????#??.??#?? 1,1,1,3,3
?#???#??????? 10,1
?.?????.?. 1,3,1
##??.??????#. 4,1,1
???##???#??? 1,7,1
?#???.#?##??#? 2,1,5,1
.??...??##? 2,4
????#??.???? 1,2,3
?#????????###????? 4,11
?#.??.?#.#?#????? 1,2,2,4,1
??????????? 3,1
##?#???#?###.#.?? 12,1
.??#??.???.??? 4,2,1
#?##?????..#.?? 5,1,1,1,1
#??#?#??.????#.??## 7,5,1,2
???#..????? 4,4
?.#??????#?. 4,2
?#??????.?. 7,1
#.?.??.#?? 1,1,1
?#?.??##.?#?.?. 2,4,2,1
????????##???.??#?? 1,2,1,5,1,2
#?.?.#???#?##?????? 1,1,12
???????????.###?#??? 1,1,7,5
????.?#??? 1,1
??#?????????#?#???? 2,11
???????#?#? 3,3
?.#?????#??????.?? 2,3,2
?.????.#?? 1,2
.???##???.?.#.. 3,1,1
???.??#??????#?#. 1,1,4,2,1
.?#??#?#?.??#? 8,2
??#?#??.????#????# 1,1,1,2,1,4
#?#?.?.???#??#..?? 1,1,1,6,1
?#??#??..????? 7,3
.????.?#??? 1,1,3
???.?##.?? 3,2,1
?.??#???.??.?? 5,1
.#?????..?.#??? 4,1
?.???????????# 1,5,1,1
?#??#???#.?#..? 1,5,2
?#??#?.?????.#????.? 2,1,4,1,1,1
#??.??#???#????? 2,4,1,2
????#??#??#.??#??? 4,4,1,1,2
.????#.??? 5,1
??##.???##? 3,5
.?#??.????????????. 3,2
.?#??..?#???##?????. 3,1,7
?.???.????#??##??#? 1,1,1,10
??##???##? 2,3
???#??##?#??#????? 12,1
.#?.??##?##..??. 1,1,5,1
???..??????? 1,1,1,1
??###.?#???##. 4,7
.??#?.?#??? 3,1
#?#???????? 6,1
#????#.#??#??????# 2,1,1,3,4
???????##??#??###?? 9,7
.??#?.?#..?????..??? 2,1,2
??#??##??#?#?#??#? 10,4
.?#?#?????#??#????# 7,2,2,1,1
??##?.?#?#..#?# 2,4,3
???#???#????.??? 1,3,5,3
?.??#??.?????.? 5,2
#.??.#??.? 1,2,2
??.#?????.#?###? 1,1,1,2,6
#?#??#?#???#?# 3,9
???.?.?????????.?. 2,1
????.???.?#. 3,2
..?#??#?.??#????.? 2,2,4
?????#.?#..? 6,2,1
?.#.##???????.??? 1,1,6,2,2
.??#?#??.#??? 5,1,1
?#?.??.#??.#?#?? 2,1,1,4
#??.??#????#???..?. 2,11,1
.??????????##?#? 2,1,2,2,2
????#?????#? 1,4,1
?#???#?.?#.???????#. 6,2,5
????..????. 1,4
???#??#.?# 1,1,2
???????#?.? 4,1
?.?????#.?.#####?? 1,1,1,1,5,1
??#??.??#???#.???#? 5,3,3,2
?#??#?.??????##? 5,5,2
?.???????? 4,1
?..????????.???#??#? 1,1,4,1,1,2
??#.??..??? 1,2,1
??#????.??#?. 4,3
???#??????????.#?? 10,2,1
??###??.#.??? 3,1,3
?#??###??#.? 2,4,1,1
##?#...?.???#???? 4,1,1,1,1
.?#??..??.???#? 3,2,1
????.???????????.#?? 1,2,4,3,2
?.??###?.??. 5,2
?.#?#??.?#??#????? 1,1,1,7,1
?..?????#?? 2,2
???????..?#..?? 2,2
?????????##????# 8,2,1,1
?.????##?##???##???# 1,15
#.?????#..?????# 1,2,2,6
????.#??.???.#.?? 1,3,3,1,1
?#??..?.??? 4,2
#?.#?.?#?? 2,1,3
#????#???? 6,2
?.###?????.?# 6,1
??##???#???.? 1,6,1
.?#??????????## 4,2,1,1,2
#???#?.??#???#???? 6,1,1,2,1,1
?#???????.?? 6,1,1
.?##?????????.???? 5,1,1,4
????##??##???????. 2,2,4,2
????#???##. 2,6
???#?????#?. 3,3
????##???#?.? 1,2,1,1
???#?????????#?#???? 4,1,1,9
????????.? 1,5
.#?.?.?.?.? 1,1,1
???????????????? 1,1,7
.?.???#????#?##??? 1,14
#.????.#??#? 1,1,1,2
?????.???#? 4,2
..???.#??????? 2,1,1,2
?#?????.?? 4,1,1
#??##??.??#??#?.??? 7,1,1,2,1,1
?.?#?#.?.??##?#??.?? 1,3,1,7,2
.#??????.#?? 6,1,1
?#?#??#????????.?. 5,2,4
##??##?#???#?.?#??? 9,2,2,1
???????#?##?##? 2,9
##?..???#.??#? 3,1,1,4
???#.?..?#?#???. 2,4,1
???#.?.?.##?. 1,2
???#.???.??# 1,1,2,2
????..?.??#?#??? 3,1,2,4
?????#??.?. 6,1
????????.???#?????? 3,1,1,6,3
???###.?.?#..#.??? 1,3,1,1,1,3
#???#?#?#??#?.? 2,6,1,1
???##??.#??#?? 2,4
???#?##?..???. 1,6,1
???#??????..??#?? 1,4,3
????#.???. 1,1,1
????..??.???????## 2,1,6
?????#?????.??? 2,6,2
???.??#?##??###? 1,7,3
##??##.??.#.???. 6,2,1,1,1
???.???????????# 2,1,1,5,1
##?.??.???#??? 2,1,4
????#?.?????#?.??.?? 5,1,3,2
.??????#???? 2,4
#??..?#?.?.?? 3,2,1
?..#?????#????? 1,1,4,1
??????.??????#? 1,1,1,1,2
?.#??????##??? 3,5,2
???..?????###? 1,8
?????#?.??.???#? 1,3,1,5
?#?.????#??#.#???.? 3,1,4,4
???????????????? 3,2,1,2
#??#???????#.???##?# 8,1,1,1,2,1
.??..?#??? 1,3
..?.??#..??????# 1,2,2,1,1
?.#??..?#???.. 2,3
??.#?.#??#.?#?. 1,1,2,3
?????????.? 3,1
???###???????#??#? 1,10,4
???????#?.??#?..#??. 3,1,3,2
.???.??#????..?? 2,6
??????##??.?#.?????? 9,1,3
#??.?#????##?. 2,3,2
?.??#??#??.?????#??# 1,6,1,1,6
?#?#????#??????###. 2,2,2,1,3
#???##?#?#?#?.????#. 1,10,2,1
.??#.?.???? 1,1,2
??##??????????# 1,2,2,3,1
???????#?.?.???? 9,2
??##.#.?????.???? 3,1,2,1,1
?.?????#.? 1,1,3
????.????#???????# 1,1,4,3
.????#???#?.#?##??? 8,5
??#??#??????????? 3,2,3,1,1
.##?.???#. 3,2
?.????#?.##.?? 1,6,2,1
??.??#???.?? 1,4,1
..###?.???????#??#? 3,1,5,2
?#???.?#..# 3,2,1
??#?#?#??#???##??? 7,1,7
.#.?..?.#????. 1,2,1
?????.??????#?. 4,2,3
.?#???..???#????.. 2,4
??????????? 1,2,2
..?????..?#?. 1,2
.?..#??.?.##?. 3,2
???#???#????? 3,1,2
.#??..?#?? 1,1,1
.#???#?#.?.??#?## 1,2,1,1,6
?#???.??#? 1,2,2
???#?#.?.?#????.?. 3,2,1
#??????..?# 3,3,2
????????.?#??## 1,2,2,3,2
????#??#?.#?.#??. 7,2,2
?.##.?#????##? 2,8
?????.#?#??#?#???# 1,1,1,1,8
????.???#?#?????.?.? 3,7,2,1
.??#?#?##?#.??## 9,3
??.??.?##?? 1,5
??##?..????? 5,1,3
???????#??????. 1,1,6
.??#?.?????#? 3,4
?##??.?#??. 5,1,1
?????.???. 2,1
??#?.###???# 4,4,1
?#.?????##?#?? 1,1,1,5
#?.??.??.#??? 1,2,1,4
????.#?.?.?????### 1,1,1,8
?#?????#??# 4,3,1
????##.???.? 6,2
?#?????????..#??. 6,1,1,1
??.????##?#?##. 4,4
????.????#???#?? 1,3,2,1
??###..?????# 5,3,2
.????#.#??#???# 1,1,1,8
??#?.????#?.. 3,1,2
????##?#?#????...? 5,4,1
???#??#?#.##??#??##? 2,3,5,2
???#?##?.? 5,1
.#.?????#??##?#? 1,2,1,3,2
#.???.???#????? 1,1,8
????#.????? 1,3,2
.??##??#?.#??.?????. 1,2,2,2,4
???#??????. 3,3
??...???.###?? 1,2,5
????????????#??. 3,1,1,1,1
.???##???#?.???. 9,2
?.?#?#.?.?#?#????#. 1,2,1,5,1
???#???.????#??? 3,2,7
????#?#??????????? 2,2,2,1,2,1
????.???..?.??.??#? 1,1,2,1,2,3
?.???.?.?###??# 2,7
?#?.???.???#?# 2,1,4,1
?????.?##?# 2,1,5
??#???##??????####?# 2,12,1
????#?...??...?? 2,2,1,2
?..???????? 1,1
.??#?.?????? 3,1
??#???#?.. 3,2
??.??.#??.??.#?# 1,2,1,3
??.#?.?#.#?? 1,2,1,1
?#?##???.#?.. 6,2
?????..????? 2,2
?????????????.?#?. 1,1,5,1,1
??.#.?#.??? 1,1,2
??.#.??#?.?????#? 1,1,4,1,4
?.??.?????????? 1,2,1,1,2
????????#?#??? 1,7,2
.????#?##??# 2,5,1
??????????. 2,2
??#?#?.???????.?.??? 6,1,2,1,2
??.?.????##??#.??. 1,1,1,2,2,1
??????#?..?.?#?#?# 1,1,4,1,6
?#?###???? 5,1
??##????#???????#?#. 5,1,1,1,4
?.#???###?#??????? 10,2
?##?#????.??????#?. 8,3
?????#?.?.??.#??? 3,3,1,2,1
.?#?.??##....?. 1,4,1
??..??.??? 1,2,1
??????.?#??? 1,2,1
?.??.#??.??????? 1,1,5
?..?#??#.??????. 1,5,5
??#?..???? 1,1
???????##? 5,3
??#?.??????##????. 1,1,1,1,3,1
?????#???##??.# 1,4,3,1,1
??#.??#???#??? 2,2,3,1
?#.?.??#??.??.??#??? 1,1,5,2,4,1
..???.???.#??.??? 3,1
??#?#?#??#??#?.#??? 8,1,2,1,2
??#????.?#? 2,2,3
?#??#?.?#??????##? 5,1,2,2
#??#??#?.#???????? 1,4,3,1,1
##?#?????#?##? 2,1,1,6
.?????????????.#? 8,2,2
??.?##.??##??##? 2,8
?#?.??#??? 1,1,1
##???.#?#.?#?????? 4,3,2,4
??#??.????????#?..? 1,3,5
?##??????? 2,6
#???.#?#???#?#.???. 4,1,2,4,1,1
???????.??#???#?# 1,9
??.????##.?#????.??? 1,6,2,1,1
?#???###?#..#.#? 2,6,1,1
?????#???#? 4,2
???#?#..#? 2,1,1
?.?#.?.?#??????.?.?? 2,7
??#???#?#??#?? 1,7
??##?.??.?##.#????? 2,1,3,1,3
#????.??#. 3,2
??#?#????..??##.#?. 9,3,2
?#?.????.???? 3,2,1,2
?#???##?#.?#? 1,1,4,1
.????????.? 2,1,1
?????????. 1,4
??????##??#?## 2,6,2
?????##?.??.???. 2,3,2
??????#?#.??##?#..#? 3,4,4,1
?##?????????. 4,5
?..??#??????. 2,3
..????.????? 1,4
??.????????? 1,1,1
.##?#???#???.#??? 6,1,1,3
?.???..??????? 1,1,1,5
?##???????.?? 4,1,2,1
??????#??#??#? 1,8
?????.???#?? 4,1,3
?..?#?..##? 2,2
?.?????#???##???.?. 2,9
..?????#????. 1,4,1
#?#?#?????# 6,1
??#?##?.???#?? 1,4,5
?#?????????. 2,4
##???.??.????#???. 4,1,1,4
.#????.??#?.?.#? 5,1,1,1,1
??##.????????.?? 2,3,2,1
###??#?.??#?. 3,2,1,2
?????#???.?#. 1,6,1
??.??##??.?# 1,6,1
??#???????#####??? 3,2,9
#????##??.?#?.?#??. 8,2,3
?????????.?.??#?. 4,1
????.?????##? 1,1,1,6
#?????.?#?#?#?.?.##? 6,1,1,2,1,2
?##????#??##??????? 8,9
??#??#?.#?##? 1,4,1,3
??#?#???.#?#???? 6,3,2
???..??#?..? 2,2
????#??#?#??#.?#.#? 1,1,3,1,1,2
?????????#?##??.?# 10,2
##????.?#?.??.? 2,2,2,2,1
?#????#??????.?##?? 3,3,2,2,3
#??##?????####???? 1,4,9
.??.#??#?.?#.###?##? 1,4,2,7
#???#??#?#?????? 3,1,2,6
???#.????#.???? 3,5,1,1
.#???#?#?.? 7,1
.?#?????#..#?.???## 1,5,2,5
#??#??#.???#??.?. 1,4,2,1,1
???#?????..#?#???#? 1,1,2,1,4,3
.??.????##?#??? 1,7,2
???##???#???. 5,1,1
??????##???. 2,5
.?????????#.???#?? 1,1,1,3,1,1
?##.??#??. 2,4
?????????.. 2,1,3
#??#?????#?? 2,1,1,2
????.##????????# 3,3,1,1,1
?????..??.?#?#? 1,1,1,5
????.##.??? 1,2,3
???#?????##?? 6,5
??????.?.# 1,1,1
??.???????#???#?.??? 1,10,1
.??##?.##??.? 4,4
.#..???#.?#??????? 1,1,2,2,1,1
??#?????????## 7,2,2
.?#.??#???? 1,3,1
?????#?.#.? 4,1
????#??.??##???#???# 1,1,8,2
??#??.?.#?#???#?#?? 2,1,9
#????#??##?????? 1,1,6,1
?##??#?.#. 6,1
?#?...??#?.?? 2,3,1
?????.?#.???#? 2,1,2,5
##?#?#???.???#??#.#? 8,1,4,1
??#?#??????? 5,1
?...?..?.?? 1,1
???#??.??? 3,2
.?.???.#?#???#??? 1,2,1,3,4
#?##.???.????#. 1,2,3,1,3
?#????.?#???#?..?? 4,1,4,2,1
.?#..???..??#??.??. 1,1
??..??.?.??###?###?# 1,1,1,1,9
##???.?.????#??#? 3,1,7
?#??#??..#?? 5,1
??.???#.?.##?? 3,2
??#???#?##.?#?##?.?? 7,2,5,2
.???.#??????????? 2,1,5,1
??.??#?#????? 5,2
#?????#?..? 1,5,1
.?????????#?? 3,3
.??.??????.#??#????. 2,2,1,8
.#.?.??????? 1,1,5
??.?#??### 1,6
#???#?#.???? 1,2,1,2
??????#??.?? 2,4,1
????.?#?#??.?. 1,1,5,1
#???.??????##?????? 1,1,8,2,1
????????##???...?#? 2,7,1
????#?#??#??????#? 6,4,1,1
#.?????.??#???? 1,1,1,3,1
??.??#.?.??????#??? 1,1,1,8
????##????????#?? 9,1,4
.??#???.?..#??.????? 5,3,3
.?##?????? 6,2
#.?#???#?? 1,3,3
????##???? 3,2,1
.??#????.??#?.#??# 1,1,1,4,1,1
#??#??????.???.??? 10,1,1
##??????.#??#??????? 4,9
?#??#.????????#?? 4,9
.#??##..?.?? 1,2,1,2
#.?#?????????#? 1,1,7,2
??#?#????? 1,1,2
.#??#???#???.#?..?? 9,1,2
?#?#?#?#?.????? 7,4
.?????.????.#?.???? 4,3,1,1,1
.?????#??? 1,4
?.???#?#???.# 1,7,1
?????#?????.???#? 7,1,2,2
#?.#?????? 1,1,1
?????.?##??????##?# 3,12
??#????????? 5,2
?..??.?#?????##??? 1,1,9
?.#?.????#????.?# 2,1,2,2,1
?#?#??#??#?#??.## 3,2,5,2
?...??#..?#. 1,1,1,1
#.???#?????#?#??? 1,12,1
?.##?.???????.#? 1,3,1,2,2
#???#??#??# 1,5,1
?????.????#.?? 1,2
?.#??##.#?? 1,3,2
??#???.???????.#?? 3,1,1,2,2,3
????#??.???..??????? 2,1,1,1,6
?##??##??#? 3,3,1
.????##??#?###?.??? 13,1,1
?.?#?##?#?????????#? 1,17
??.?#.??#?.????#??? 1,1,4,1,6
??.??.?.?#.?????## 2,1,1,1,1,2
??.###???#??..? 2,7,1,1
???.???###?????# 1,11
#??.#?#?????.? 1,1,3,1
????#???????????.. 4,3,1,2
?#??#??##??.##??? 10,5
#..???#????#?#??? 1,9
????????#.??? 2,5,2
?#.??#.?????. 1,1,1,3
??.?.??##???? 1,7
.??.#?.#.?#?.??.?. 2,1,1,2,1,1
.?????#???#??.?##?? 1,1,1,1,1,4
????#?.?#.?. 5,1
#..?#?###???? 1,8,1
?#?#?????.#..???? 3,3,1,1,1
.?????##??? 3,3,1
????##??????# 2,9
?#.?#?????? 1,3,2
?#???#.#??#?.#???? 1,3,1,3,5
?.??##???????? 4,4
?..???????#??.???? 1,1,2,3,3
?####??.?#?. 5,1
.???#.??.??.?????? 2,1,1,2,2,1
.???.?.?#????#?? 1,1,1,1,3
?#???#??.#.?.. 5,1
#???.#?#.#??#??#.?? 4,1,1,5,1,1
"

def valid_permutation?(springs, new_spring_locations, group_sizes)
  current_group = 0
  counted_groups = []
  springs.each_with_index do |spring_char, i|
    if spring_char == '#' || new_spring_locations.include?(i)
      current_group += 1
    else
      counted_groups << current_group if current_group != 0
      current_group = 0
      return false if group_sizes.first(counted_groups.size) != counted_groups
    end
  end
  counted_groups << current_group if current_group != 0
  # puts "counted #{counted_groups.join(',')}, expected #{group_sizes.join(',')}"
  counted_groups == group_sizes
end

def valid_remainder?(springs, group_sizes)
  current_group = 0
  counted_groups = []
  springs.each_with_index do |spring_char, i|
    if spring_char == '#' || spring_char == '?'
      current_group += 1
    else
      counted_groups << current_group if current_group != 0
      current_group = 0
    end
  end
  counted_groups << current_group if current_group != 0
  puts "checking valid remainder: #{counted_groups == group_sizes} (#{springs.join('')}, #{group_sizes.join(',')})"
  counted_groups == group_sizes
end

def count_permutations(springs,locations_of_possible_springs, group_sizes, unknown_spring_count )
  puts "springs: #{springs&.join('')}, locations_of_possible_springs: #{locations_of_possible_springs}, unknown_spring_count: #{unknown_spring_count}, group_sizes: #{group_sizes&.join(',')}"

  if springs == nil
    # puts "springs nil"
    return 0
  end
  # puts "springs[0...group_sizes[0]] #{springs[0...group_sizes[0]]}"
  if springs[0...group_sizes[0]].uniq == ['#']
    puts "next #{group_sizes[0]} are #, next"
    updated_locations_of_possible_springs = locations_of_possible_springs.map{|loc| loc - group_sizes[0] }.filter{|loc| loc >= 0}
    count_permutations(springs[group_sizes[0]..-1],updated_locations_of_possible_springs, group_sizes[1..-1], unknown_spring_count )
  end

  if springs[0] == '.'
    puts "next is ., next"
    updated_locations_of_possible_springs = locations_of_possible_springs.map{|loc| loc -1}.filter{|loc| loc >= 0}
    count_permutations(springs[1..-1],updated_locations_of_possible_springs, group_sizes, unknown_spring_count )
  end
  # puts "calling count_permutations with #{springs.join('')} -- #{locations_of_possible_springs.join(',')}  -- #{group_sizes.join(',')}"

  if unknown_spring_count == 0 # on the 9th iteration, you can't place any more springs or further iterate
    puts "unknown_spring_count == 0"
    return 1 if valid_remainder?(springs, group_sizes)
  end

  if group_sizes == nil || group_sizes == []
    puts "matched all gropus without springs"
    return 0
  end
  if locations_of_possible_springs == nil || locations_of_possible_springs == []
    # puts "locations_of_possible_springs nil"
    return 0
  end


  # puts "remaining group sizes:#{group_sizes.join(',')} "
  this_group_size = group_sizes[0]
  this_location = locations_of_possible_springs[0]
  valid_permutations = 0

  cloned_springs = springs.clone

  cloned_springs[this_location] = '#'

  # locations_of_possible_springs.each_with_index do |location, i|
  current_group = 0
  cloned_springs.each_with_index do |spring_char, j|
    if spring_char == '#'
      current_group += 1
    else
      if current_group > 0 # if we found a group...
        # puts "found a group of size #{current_group}, expected #{this_group_size}"
        if current_group != this_group_size  #   ... of the wrong size
          valid_permutations += 0
        else #   ... of the right size
          # puts "cloned_springs: #{cloned_springs.join('')}, locations_of_possible_springs: #{locations_of_possible_springs}"
          puts "found a group of size #{current_group}! checking next spots"
          if group_sizes[1..-1] == []
            puts "FOUND VALID PERMUTATION! #{locations_of_possible_springs}"
            return 1
          end
          updated_locations_of_possible_springs = locations_of_possible_springs.map{|loc| loc - j -1}.filter{|loc| loc >= 0}
          # puts "updated_locations_of_possible_springs: #{updated_locations_of_possible_springs.join(',')}"
          if updated_locations_of_possible_springs == [] && unknown_spring_count == 1
            puts 'FOUND VALID 2'
            return 1 if valid_remainder?(springs, group_sizes)
          end
          updated_locations_of_possible_springs[0..-1].each_with_index do |location, i|
            valid_permutations += count_permutations(cloned_springs[j+1..-1],updated_locations_of_possible_springs[i..-1],  group_sizes[1..-1], unknown_spring_count - 1)
            puts "TOTAL VALID COUNT #{valid_permutations} for stack level #{unknown_spring_count}"
          end
          puts "TOTAL post-loop VALID COUNT #{valid_permutations} for stack level #{unknown_spring_count}"

          break
        end
      end
    end
  end

  valid_permutations
end

def count_arrangements_for_row(row)
  folded_springs = row.split(' ')[0].split('')
  folded_group_sizes = row.split(' ')[1].split(',').map(&:to_i)

  springs = folded_springs.map(&:clone) + ['?'] + folded_springs.map(&:clone) + ['?'] + folded_springs.map(&:clone) + ['?'] + folded_springs.map(&:clone) + ['?'] + folded_springs.map(&:clone)
  group_sizes = folded_group_sizes.map(&:clone) + folded_group_sizes.map(&:clone) + folded_group_sizes.map(&:clone) + folded_group_sizes.map(&:clone) + folded_group_sizes.map(&:clone)

  total_springs = group_sizes.sum
  known_springs = springs.count('#')
  # possible_springs = springs.count('?')
  unknown_spring_count = total_springs - known_springs
  locations_of_possible_springs = springs.each_index.select{|i| springs[i] == '?'}

  valid_permutations = 0
  # puts "checking locations_of_possible_springs #{locations_of_possible_springs.join(',')}"
  locations_of_possible_springs.first(1).each_with_index do |location, i|
    puts " -------- checking new starting spot -------- "
    valid_permutations += count_permutations(springs,locations_of_possible_springs[i..-1], group_sizes, unknown_spring_count)
  end
  # valid_permutations = count_permutations(springs,locations_of_possible_springs, 0, group_sizes)



  puts "#{valid_permutations} valid_permutations for row #{springs.join('')}"
  valid_permutations
end

def count_arrangements(input)
  rows = input.split("\n")
  total = 0
  rows.first(1).each do |row|
    total += count_arrangements_for_row(row)
  end
  total
end

puts count_arrangements(test_input)